<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script src="https://unpkg.com/vue@2.7.8/dist/vue.js"></script>
    <link rel="stylesheet" href="styles.css">
    <title>Classical Music Lessons</title>
</head>
<body>
<div id="app">
    <header>
        <h1>{{message}}</h1>

        <!-- cart indicator as a button; disabled when cart is empty -->
        <button class="cart-button" v-on:click="toggleCart" :disabled="cart.length === 0" :aria-pressed="showCart">
          <img src="images/shopping-cart.png" alt="Cart" class="cart-icon">
          <span class="cart-count">{{ cart.length }}</span>
        </button>

    </header>

    <main>

        <!-- Sort controls and lessons are shown when not viewing cart -->
        <div v-if="!showCart">
            <!-- Sort controls -->
            <div class="sort-controls">
                <label>
                    Sort by:
                    <select v-model="sort.field">
                        <option value="subject">Subject</option>
                        <option value="location">Location</option>
                        <option value="price">Price</option>
                        <option value="spaces">Spaces</option>
                    </select>
                </label>

                <label>
                    Order:
                    <select v-model="sort.direction">
                        <option value="asc">Ascending</option>
                        <option value="desc">Descending</option>
                    </select>
                </label>
            </div>
            <br>

            <!-- Search bar -->
            <div class="search-wrapper">
              <!-- Search input: v-model keeps DOM and data in sync; @input triggers debounced search handler-->
             <input id="search" class="search-input" type="search" placeholder="Search lessons..." v-model="searchQuery" @input="onSearchInput" aria-label="Search lessons">
            </div>

            <!-- Render all lessons using v-for and a method that returns the lessons -->
            <section class="lessons">
                <article v-for="(lesson, index) in displayLessons()" :key="lesson.origIndex" class="lesson">
                    <img :src="lesson.image" :alt="lesson.subject" width="120">
                    <h2>{{ lesson.subject }}</h2>
                    <p><strong>Location:</strong> {{ lesson.location }}</p>
                    <p><strong>Price:</strong> {{ lesson.price }}</p>
                    <p><strong>Spaces:</strong> {{ lesson.spaces }}</p>

                    <!-- Add to Cart button; disabled when no spaces left-->
                    <button class="btn-add" v-on:click="addToCart(lesson, lesson.origIndex)" :disabled="lesson.spaces === 0">
                      {{ lesson.spaces === 0 ? 'Out Of Seats' : 'Add To Cart' }}
                    </button>

                </article>
            </section>
        </div>

        <!-- Cart page: shown when viewing cart -->
        <div v-if="showCart">
            <section class="cart-page">
                <h2>Your Cart</h2>
                <p v-if="cart.length === 0">Your cart is empty.</p>

                <!-- Cart items displayed as small cards -->
                <section class="cart-items">
                  <article v-for="(entry, cidx) in cart" :key="entry.origIndex" class="cart-card">
                    <img :src="entry.image" :alt="entry.subject" class="cart-card-img">
                    <div class="cart-card-body">
                      <h3>{{ entry.subject }}</h3>
                      <p class="cart-location">Location: {{ lessons[entry.origIndex].location }}</p>
                      <p class="cart-price">Price: {{ entry.price }}</p>

                      <div class="qty-controls">
                        <button class="qty-btn" v-on:click="decreaseQuantity(cidx)">-</button>
                        <span class="qty">{{ entry.qty }}</span>
                        <button class="qty-btn" v-on:click="increaseQuantity(cidx)">+</button>
                      </div>
                    </div>

                    <div class="cart-card-actions">
                      <button class="btn-remove" v-on:click="removeFromCart(cidx)">Remove</button>
                    </div>
                  </article>
                </section>

                <div class="cart-summary" v-if="cart.length > 0">
                    <div>Total: <strong>{{ totalPrice }}</strong></div>
                </div>

                <!-- Checkout form: always visible in cart page -->
                <section class="checkout">
                  <h3>Checkout</h3>
                  <label>
                    Name:
                    <input type="text" v-model="order.name" placeholder="Full name">
                  </label>
                  <label>
                    Phone:
                    <input type="text" v-model="order.phone" placeholder="Phone number">
                  </label>

                  <div class="checkout-actions">
                    <button class="btn-checkout" v-on:click="checkout" :disabled="!checkoutEnabled">Checkout</button>
                  </div>

                  <p class="confirmation" v-if="order.submitted">{{ order.confirmationMessage }}</p>
                </section>

            </section>
        </div>

    </main>

    <div v-if="order.showModal" class="modal-overlay">
      <div class="modal">
        <h3>Order Submitted</h3>
        <p>{{ order.confirmationMessage }}</p>
        <button class="modal-close" v-on:click="closeModal">Close</button>
      </div>
    </div>

</div>

<script type="module" src="index.js"></script>
</body>
</html>
